# 使用 Windows Server Core 作为基础镜像
FROM mcr.microsoft.com/windows/servercore:ltsc2019

# 安装 Node.js
RUN powershell -Command \
    Invoke-WebRequest -OutFile nodejs.msi https://nodejs.org/dist/latest-v16.x/node-v16.20.2-x64.msi; \
    Start-Process -FilePath "msiexec.exe" -ArgumentList "/i", "nodejs.msi", "/quiet", "/norestart" -Wait; \
    Remove-Item nodejs.msi

# 设置工作目录
WORKDIR /app

# 复制 package.json 和 package-lock.json（如果存在）
COPY package*.json ./

# 安装依赖
RUN npm ci

# 复制项目文件
COPY . .

# 构建应用
RUN npm run build

# 安装 http-server 来运行静态文件
RUN npm install -g http-server

# 暴露端口
EXPOSE 8080

# 启动应用
CMD ["http-server", "dist", "-p", "8080"]