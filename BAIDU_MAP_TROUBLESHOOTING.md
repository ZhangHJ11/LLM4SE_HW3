# 百度地图路线规划故障排查指南

## 当前问题

用户在点击"规划路线"时遇到以下问题：
1. ✅ 已修复：地图初始化时 `OverviewMapControl is not a constructor` 错误
2. ❌ 待解决：路线规划状态码5（请求超时）

## 调试步骤

### 1. 检查控制台输出

请打开浏览器开发者工具（F12），查看控制台中的以下信息：

```
🚗 开始路线规划
📍 出发点: [出发点名称]
📍 终点: [终点名称]
🗺️ 地图实例: [地图对象]
🔧 BMapGL 对象: [BMapGL对象]
🔧 DrivingRoute 类: [DrivingRoute类]
🗑️ 已清除之前的路线
📍 已重新添加景点标记
🔍 调用 driving.search()
   起点: [出发点名称]
   终点: [终点名称]
🔍 search() 返回值: [返回值]
✅ 路线规划回调触发
📊 路线规划状态码: [状态码]
📦 返回结果: [结果对象]
```

### 2. 分析状态码

根据控制台输出的状态码，判断问题原因：

- **状态码 0**: 成功 ✅
- **状态码 1**: 起点信息有误
- **状态码 2**: 终点信息有误
- **状态码 3**: 起终点信息有误
- **状态码 4**: 网络错误
- **状态码 5**: 请求超时或地点无法解析

### 3. 常见问题及解决方案

#### 问题1: 状态码5 - 请求超时

**可能原因：**
1. 地点名称不够精确，无法被百度地图识别
2. 地点名称包含特殊字符或格式
3. 网络连接问题
4. API配额限制

**解决方案：**

**方案A：优化地点名称**
```javascript
// 在下拉列表中显示更精确的地点名称
// 例如：不要只显示"景点"，而是显示"北京天安门广场"
```

**方案B：手动测试地点**
请在控制台告诉我以下信息：
1. 您选择的出发点名称是什么？
2. 您选择的终点名称是什么？
3. 这些地点名称是从哪里提取的？（dailyPlans 还是 recommendations）

**方案C：使用更可靠的地点格式**
尝试以下格式：
- "城市+地点名"，例如："北京市天安门广场"
- "完整地址"，例如："北京市东城区东长安街"
- "经纬度坐标"（最可靠）

#### 问题2: 地点名称不准确

**检查方法：**
```javascript
// 查看控制台中的景点列表
console.log('景点列表:', attractions);
```

**解决方案：**
1. 确保AI生成的旅行计划中包含准确的地点信息
2. 地点名称应该包含城市名称
3. 避免使用模糊或过于简短的地点名称

#### 问题3: 网络或API问题

**检查方法：**
1. 查看浏览器 Network 标签，确认API请求是否成功
2. 检查是否有CORS错误
3. 确认API密钥是否有效且有配额

## 下一步诊断

请按以下步骤协助排查：

### 步骤1: 查看控制台输出
复制控制台中所有以 🚗 开头的调试信息，并告诉我：
- 出发点的完整名称
- 终点的完整名称
- 状态码是多少
- 是否有其他错误信息

### 步骤2: 检查景点数据
在控制台输入以下命令并告诉我结果：
```javascript
// 查看当前提取的景点列表
console.log(attractions);
```

### 步骤3: 测试地理编码
在控制台输入以下代码测试地点是否可以被识别：
```javascript
const geocoder = new window.BMapGL.Geocoder();
geocoder.getPoint("您的出发点名称", function(point) {
  console.log('出发点坐标:', point);
}, "城市名");

geocoder.getPoint("您的终点名称", function(point) {
  console.log('终点坐标:', point);
}, "城市名");
```

## 可能的临时解决方案

如果上述方法都不行，我们可以：

1. **修改为使用坐标方式**：
   - 先用地理编码将地点名称转换为坐标
   - 然后使用坐标进行路线规划

2. **添加城市名称前缀**：
   - 在地点名称前自动添加目的地城市名
   - 例如：如果目的地是"东京"，将"浅草寺"改为"东京浅草寺"

3. **使用备选API**：
   - 如果百度地图GL版本有问题，可以尝试使用普通版本
   - 或者提供文字路线说明而不是地图路线

## 需要您提供的信息

请提供以下信息以便我进一步诊断：

1. **控制台完整输出**（包括所有 🚗 相关的日志）
2. **景点列表内容**
3. **旅行计划目的地**（哪个城市）
4. **是否可以看到地图**（地图是否正常显示）
5. **景点标记是否显示**（地图上是否有标记点）

有了这些信息，我可以更准确地定位问题并提供解决方案。
